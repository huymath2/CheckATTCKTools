$ErrorActionPreference= 'silentlycontinue'
function Get-ExchangeMalwarePersistent{
    $Path = @("C:\Program Files\Microsoft\Exchange Server\V15\TransportRoles\agents\agents.config","C:\Program Files\Microsoft\Exchange Server\V15\TransportRoles\Shared\agents.config")
    $XPath = "/configuration/mexRuntime/agentList/agent"
    $Path | Where-Object { Test-Path -Path $_ -PathType Leaf} | ForEach-Object{ 
        (Select-Xml -Path $_ -XPath $Xpath).node | ForEach-Object { 
            $_
        }
    }
}

Get-ExchangeMalwarePersistent | Format-List